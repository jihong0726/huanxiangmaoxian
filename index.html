<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<title>å¹»æƒ³å†’é™© Abyss Reborn</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #111;
        color: #eee;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    #gameContainer {
        max-width: 600px;
        margin-top: 40px;
        padding: 20px;
        background: #222;
        border-radius: 8px;
        box-shadow: 0 0 15px rgba(255,255,255,0.1);
    }
    button {
        background: #444;
        color: #fff;
        border: none;
        padding: 10px 20px;
        margin: 5px;
        cursor: pointer;
        border-radius: 6px;
    }
    button:hover {
        background: #666;
    }
    .section {
        margin-bottom: 20px;
    }
    .hidden {
        display: none;
    }
    #eventDesc {
        margin: 15px 0;
        line-height: 1.5em;
    }
    #inventoryBox {
        background: #333;
        padding: 10px;
        margin-top: 10px;
        border-radius: 6px;
    }
</style>
</head>
<body>
<div id="gameContainer">
    <h1>ğŸŒŒ å¹»æƒ³å†’éšª Abyss Reborn</h1>
    <div id="statusBox"></div>
    <div id="eventDesc"></div>
    <div id="options"></div>
    <div id="inventoryBox">
        <strong>ğŸ’ èƒŒåŒ…ï¼š</strong>
        <div id="inventory"></div>
    </div>
</div>

<script>
/* ==============================
   ğŸŒŸ ç©å®¶åˆå§‹å±¬æ€§
================================= */
let player = {
    hp: 100,
    maxHp: 100,
    atk: 10,
    gold: 0,
    floor: 1,
    artifacts: [],
    hasEscapedBoss: false
};

/* ==============================
   ğŸ ç¥å™¨æ± ï¼ˆä¸é‡è¤‡æ‰è½ï¼Œå„ªå…ˆçµ¦æœªæ“æœ‰ï¼‰
================================= */
const artifactPool = [
    "ğŸŒ ç¥ä¹‹å…‰è¼",
    "âš¡ é›·éœ†ä¹‹å¿ƒ",
    "ğŸ”¥ ä¸æ»…ç«ç¨®",
    "ğŸ’ æ°¸æ’æ°´æ™¶",
    "ğŸŒ™ æš—å½±ä¹‹å¥‘"
];

/* ==============================
   ğŸ” äº‹ä»¶è¼ªè¿´ï¼ˆæ¯ 5 å±¤ä¸€å¾ªç’°ï¼‰
================================= */
function getEventType(floor) {
    if (floor % 20 === 0) return "boss";          
    if (floor % 5 === 1) return "battle";         
    if (floor % 5 === 2) return "shop";           
    if (floor % 5 === 3) return "heal";           
    if (floor % 5 === 4) return "treasure";       
    return "battle";                              
}

/* ==============================
   ğŸ“¦ é‡‘ç®±å­æ‰è½å„ªå…ˆé‚è¼¯ï¼ˆç¥å™¨å¿…å‡ºï¼Œä¸”ä¸é‡è¤‡ï¼‰
================================= */
function getTreasureReward() {
    let availableArtifacts = artifactPool.filter(a => !player.artifacts.includes(a));
    if (availableArtifacts.length > 0) {
        let chosen = availableArtifacts[Math.floor(Math.random() * availableArtifacts.length)];
        player.artifacts.push(chosen);
        return `ä½ ç²å¾—äº†ç¥å™¨ï¼š${chosen} âœ¨`;
    } else {
        let goldGain = Math.floor(Math.random() * 200) + 100;
        player.gold += goldGain;
        return `æ²’æœ‰æ–°çš„ç¥å™¨å¯æ‹¾å–ï¼Œä½ ç²å¾—äº† ${goldGain} é‡‘å¹£ï¼`;
    }
}

/* ==============================
   â™»ï¸ ä¸»éŠæˆ²æµç¨‹æ§åˆ¶
================================= */
function updateStatus() {
    document.getElementById("statusBox").innerHTML =
        `ğŸ§â€â™‚ï¸ HP: ${player.hp}/${player.maxHp} | âš”ï¸ ATK: ${player.atk} | ğŸ’° Gold: ${player.gold} | ğŸ” Floor: ${player.floor}`;
    document.getElementById("inventory").innerHTML =
        player.artifacts.length > 0
            ? player.artifacts.join(", ")
            : "ï¼ˆç©ºç©ºå¦‚ä¹Ÿï¼‰";
}

function startNextEvent() {
    updateStatus();
    const eventType = getEventType(player.floor);
    if (eventType === "battle") battleEvent();
    if (eventType === "shop") shopEvent();
    if (eventType === "heal") healEvent();
    if (eventType === "treasure") treasureEvent();
    if (eventType === "boss") bossEvent();
}

/* ==============================
   âš”ï¸ æˆ°é¬¥äº‹ä»¶
================================= */
function battleEvent() {
    document.getElementById("eventDesc").innerHTML =
        `ä½ é‡åˆ°äº†æ€ªç‰©ï¼<br>ğŸ”¥ å¿…å®šæš´æ“Šï¼Œä½ é€ æˆ ${player.atk * 2} å‚·å®³ä¸¦æ“Šæ•—æ•µäººï¼`;
    player.gold += 50;
    renderOptions(["ç¹¼çºŒå‰é€²"]);
}

/* ==============================
   ğŸª å•†åº—äº‹ä»¶
================================= */
function shopEvent() {
    let msg = `ä½ é‡åˆ°äº†å•†äºº ğŸ›’<br>èŠ±è²» 50 é‡‘å¹£å¯ä»¥æå‡ 5 é»æ”»æ“ŠåŠ›ï¼`;
    document.getElementById("eventDesc").innerHTML = msg;
    renderOptions(["è³¼è²·æå‡", "è·³é"]);
}

/* ==============================
   ğŸ’š ä¼‘æ¯å›è¡€äº‹ä»¶
   ï¼ˆè¡€é‡ â‰¥80% å‰‡ä¸è§¸ç™¼ï¼Œæ”¹ç‚ºæˆ°é¬¥ï¼‰
================================= */
function healEvent() {
    if (player.hp >= player.maxHp * 0.8) {
        document.getElementById("eventDesc").innerHTML =
            `ä½ æœ¬ä¾†è¦ä¼‘æ¯ï¼Œä½†ç‹€æ…‹è‰¯å¥½ï¼Œç›´æ¥é€²å…¥æˆ°é¬¥ï¼`;
        battleEvent();
        return;
    }
    player.hp = Math.min(player.maxHp, player.hp + 40);
    document.getElementById("eventDesc").innerHTML =
        `ä½ å®‰å…¨åœ°ä¼‘æ¯ï¼Œæ¢å¾©äº†ç”Ÿå‘½å€¼ ğŸ’–`;
    renderOptions(["ç¹¼çºŒå‰é€²"]);
}

/* ==============================
   ğŸ’ é‡‘è‰²å¯¶ç®±äº‹ä»¶ï¼ˆä¿åº•ä¸”ä¸é‡è¤‡ï¼‰
================================= */
function treasureEvent() {
    document.getElementById("eventDesc").innerHTML =
        `ä½ ç™¼ç¾äº†é‡‘è‰²å¯¶ç®± âœ¨<br>${getTreasureReward()}`;
    renderOptions(["ç¹¼çºŒå‰é€²"]);
}

/* ==============================
   ğŸ‘¹ Bossæˆ°ï¼ˆæ¯ 20 å±¤å›ºå®šï¼‰
================================= */
function bossEvent() {
    document.getElementById("eventDesc").innerHTML =
        `ğŸ¯ ä½ é‡åˆ°äº† Bossï¼<br>
         ä½ é¸æ“‡é€ƒè·‘ â€”â€” ğŸ’¨ æ°¸é æˆåŠŸé€ƒé›¢ï¼<br>
         Boss è¢«é–ƒé›»éœ‡æ‡¾ï¼Œç•™ä¸‹ä¸€ä»¶ç¥å™¨ï¼<br><br>${getTreasureReward()}`;

    player.hp = player.maxHp;
    renderOptions(["é€²å…¥ä¸‹ä¸€è¼ªæ·±æ·µ"]);
}

/* ==============================
   ğŸ¯ é¸é …æ¸²æŸ“
================================= */
function renderOptions(optionTexts) {
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";

    optionTexts.forEach(text => {
        let btn = document.createElement("button");
        btn.innerText = text;
        btn.onclick = () => handleOption(text);
        optionsDiv.appendChild(btn);
    });
}

/* ==============================
   ğŸ§  é¸é …åˆ¤å®š
================================= */
function handleOption(choice) {
    if (choice === "ç¹¼çºŒå‰é€²" || choice === "é€²å…¥ä¸‹ä¸€è¼ªæ·±æ·µ") {
        player.floor++;
    }
    if (choice === "è³¼è²·æå‡" && player.gold >= 50) {
        player.gold -= 50;
        player.atk += 5;
        alert("ä½ çš„æ”»æ“ŠåŠ›æå‡äº†ï¼");
    }
    startNextEvent();
}

/* ==============================
   ğŸš€ åˆå§‹åŒ–éŠæˆ²
================================= */
startNextEvent();
</script>
</body>
</html>
