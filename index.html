<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <title>å¹»æƒ³å†’éšª - Abyss Reborn</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1e1e1e;
            color: white;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .stats, .inventory, .actions, .event {
            border: 1px solid #444;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #2b2b2b;
        }
        button {
            padding: 10px 15px;
            background-color: orange;
            border: none;
            margin: 5px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 6px;
        }
        button:hover {
            background-color: #ffae42;
        }
        .golden {
            color: gold;
            font-weight: bold;
        }
    </style>
</head>

 <body>
<div class="container">
    <h1>âš” å¹»æƒ³å†’éšª Abyss Reborn</h1>

    <div id="stats" class="stats"></div>
    <div id="event" class="event"></div>
    <div id="actions" class="actions"></div>
    <div id="inventory" class="inventory"></div>
</div>

  <script>
// ===== ç©å®¶æ•¸æ“š =====
const Player = {
    name: "å†’éšªè€…",
    baseAtk: 10,
    maxHP: 100,
    hp: 100,
    gold: 200,
    depth: 1,
    inventory: {
        equipment: [],
    },
    equipment: { weapon: null, armor: null, shield: null },
};

// ===== è£å‚™æ± ï¼ˆå¯æ“´å……ï¼‰=====
const CONFIG = {
    rarityProb: { legendary: 0.05, epic: 0.15, rare: 0.3, common: 0.5 },
    itemPool: [
        { name: "ç¥ä¹‹å…‰è¼", rarity: "legendary", type: "weapon", val: 50 },
        { name: "é³³å‡°è–ç›¾", rarity: "legendary", type: "shield", val: 40 },
        { name: "å¤©ä½¿ç¾½è¡£", rarity: "legendary", type: "armor", val: 45 },
        { name: "é¾ç„°ä¹‹æ–§", rarity: "epic", type: "weapon", val: 40 },
        { name: "ç§˜éŠ€ä¹‹ç›¾", rarity: "epic", type: "shield", val: 32 },
        { name: "ç²¾éˆè¼•ç”²", rarity: "epic", type: "armor", val: 34 },
        { name: "é‹¼éµé•·åŠ", rarity: "rare", type: "weapon", val: 25 },
        { name: "é¨å£«ç›¾ç‰Œ", rarity: "rare", type: "shield", val: 20 },
        { name: "çµäººçš®ç”²", rarity: "rare", type: "armor", val: 22 },
        { name: "æœ¨æ£’", rarity: "common", type: "weapon", val: 5 },
        { name: "ç ´èˆŠç›¾ç‰Œ", rarity: "common", type: "shield", val: 5 },
        { name: "å¸ƒç”²", rarity: "common", type: "armor", val: 6 },
    ],
};

// ====== æ ¸å¿ƒ Game ç‰©ä»¶ =====
const Game = {
    // å–å¾—æ”»æ“ŠåŠ›
    getAtk() {
        let atk = Player.baseAtk;
        if (Player.equipment.weapon) atk += Player.equipment.weapon.val;
        return atk;
    },

    // æ˜¯å¦å·²æœ‰å‚³èªªè£å‚™ï¼ˆå«èƒŒåŒ…ï¼‰
    hasLegendaryEquip() {
        const check = (item) => item && item.rarity === "legendary";
        if (check(Player.equipment.weapon) ||
            check(Player.equipment.armor) ||
            check(Player.equipment.shield)) return true;
        return Player.inventory.equipment.some(check);
    },

    // ç”Ÿæˆè£å‚™ï¼ˆå«ä¿åº•æ©Ÿåˆ¶ï¼‰
    generateRandomItem(tierModifier = "normal") {
        const needGuaranteeLegend = Player.depth >= 15 && !this.hasLegendaryEquip();
        let rarityKey = needGuaranteeLegend ? "legendary" : this.getRandomRarity();

        let pool = CONFIG.itemPool.filter(i => i.rarity === rarityKey);

        if (needGuaranteeLegend) {
            pool = pool.filter(i => ["weapon", "armor", "shield"].includes(i.type));
        }
        const item = pool[Math.floor(Math.random() * pool.length)];
        return { ...item };
    },

    getRandomRarity() {
        const r = Math.random();
        const table = CONFIG.rarityProb;
        let acc = 0;
        for (let key in table) {
            acc += table[key];
            if (r <= acc) return key;
        }
        return "common";
    },

    // å›ºå®šäº‹ä»¶é †åºï¼ˆå–æ¶ˆç¥ˆç¦±ã€é™·é˜±ï¼‰
    getEventTypeForDepth(depth) {
        if (depth % 20 === 0) return "boss";
        if (depth % 5 === 1) return "combat";
        if (depth % 5 === 2) return "merchant";
        if (depth % 5 === 3) return Player.hp < Player.maxHP * 0.8 ? "heal" : "combat";
        if (depth % 5 === 4) return "chest";
        return "combat";
    },

    // ä¸»äº‹ä»¶æ§åˆ¶å™¨
    nextEvent() {
        const eventType = this.getEventTypeForDepth(Player.depth);
        if (eventType === "combat") this.triggerCombat();
        if (eventType === "merchant") this.triggerMerchant();
        if (eventType === "heal") this.triggerHeal();
        if (eventType === "chest") this.triggerChest(true);
        if (eventType === "boss") this.triggerBossBattle();
        this.updateUI();
    },

    triggerCombat() {
        document.getElementById("event").innerHTML = `âš” ç¬¬ ${Player.depth} å±¤ é­é‡æ€ªç‰©ï¼æˆ°é¬¥é–‹å§‹ï¼`;
        document.getElementById("actions").innerHTML = `
            <button onclick="Game.winCombat()">æˆ°é¬¥å‹åˆ©</button>
            <button onclick="Game.escape()">é€ƒè·‘ï¼ˆ100%æˆåŠŸï¼‰</button>
        `;
    },

    winCombat() {
        Player.gold += 50;
        Player.depth++;
        this.nextEvent();
    },

    triggerMerchant() {
        document.getElementById("event").innerHTML = `ğŸ›’ å•†åº—å‡ºç¾ï¼ä½ å¯ä»¥è³¼è²·æˆ–é›¢é–‹ã€‚`;
        document.getElementById("actions").innerHTML = `<button onclick="Game.leave()">é›¢é–‹</button>`;
    },

    triggerHeal() {
        Player.hp = Math.min(Player.maxHP, Player.hp + 30);
        document.getElementById("event").innerHTML = `â¤ï¸ å›å¾©äº‹ä»¶ï¼ä½ çš„ç”Ÿå‘½æ¢å¾©åˆ° ${Player.hp}`;
        document.getElementById("actions").innerHTML = `<button onclick="Game.leave()">ç¹¼çºŒå‰é€²</button>`;
    },

    triggerChest(isGolden = false) {
        let item;
        if (isGolden) {
            document.getElementById("event").innerHTML = "ğŸ— é‡‘è‰²å¯¶ç®±å‡ºç¾ï¼å¿…æ‰è½å¯¶ç‰©ï¼";
            if (!this.hasLegendaryEquip()) {
                item = CONFIG.itemPool.find(i => i.rarity === "legendary");
            } else {
                item = this.generateRandomItem("boss");
            }
        } else {
            item = this.generateRandomItem();
        }
        Player.inventory.equipment.push(item);
        document.getElementById("actions").innerHTML = `
            <p>ğŸ ç²å¾—ï¼š<span class="golden">${item.name}</span></p>
            <button onclick="Game.leave()">ç¹¼çºŒå‰é€²</button>
        `;
    },

    triggerBossBattle() {
        document.getElementById("event").innerHTML =
            `ğŸ‘‘ æ¥µé™Bosså‡ºç¾ï¼ç¬¬ ${Player.depth} å±¤å®ˆé–€è€…ç™»å ´ï¼`;
        document.getElementById("actions").innerHTML = `
            <button onclick="Game.winBoss()">æ“Šæ•—Boss</button>
            <button onclick="Game.escape()">é€ƒè·‘ï¼ˆ100%æˆåŠŸï¼‰</button>
        `;
    },

    winBoss() {
        Player.hp = Player.maxHP;
        Player.depth++;
        this.triggerChest(true);
    },

    escape() {
        Player.depth++;
        this.nextEvent();
    },

    leave() {
        Player.depth++;
        this.nextEvent();
    },

    updateUI() {
        document.getElementById("stats").innerHTML = `
            ğŸ”¹ åç¨±ï¼š${Player.name}<br>
            â¤ï¸ HPï¼š${Player.hp}/${Player.maxHP}<br>
            ğŸ’° é‡‘å¹£ï¼š${Player.gold}<br>
            ğŸ—¡ æ”»æ“ŠåŠ›ï¼š${this.getAtk()}<br>
            â›³ æ·±åº¦ï¼šç¬¬ ${Player.depth} å±¤<br>
        `;
        document.getElementById("inventory").innerHTML = `
            ğŸ’ è£å‚™èƒŒåŒ…ï¼š${Player.inventory.equipment.map(i => i.name).join(", ") || "ç„¡"}
        `;
    },
};

window.onload = () => Game.nextEvent();
</script>
