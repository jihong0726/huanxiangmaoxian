<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹»æƒ³å†’éšª</title>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --panel-color: #2d2d2d;
            --text-color: #e0e0e0;
            --accent-color: #ff9800;
            --border-radius: 8px;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            
            /* Rarity Colors */
            --common: #b0b0b0;
            --uncommon: #4caf50;
            --rare: #2196f3;
            --epic: #9c27b0;
            --legendary: #ffd700;
            --mythic: #ff0055;
            --ultra: #00ffcc;
            
            /* Buff Colors */
            --buff-angel: #4fc3f7;
            --buff-demon: #ef5350;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        #game-container {
            width: 100%;
            max-width: 700px;
            background-color: var(--panel-color);
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            gap: 15px;
            position: relative;
        }

        /* Header & Stats */
        header {
            border-bottom: 2px solid #444;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .class-badge {
            font-size: 0.8em;
            background: #444;
            padding: 2px 8px;
            border-radius: 4px;
            color: var(--accent-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            background: #222;
            padding: 10px;
            border-radius: var(--border-radius);
            font-size: 0.9em;
        }

        .stat-item span { font-weight: bold; color: var(--accent-color); }
        
        #buff-display {
            grid-column: span 2;
            border-top: 1px solid #444;
            padding-top: 5px;
            margin-top: 5px;
            font-size: 0.85em;
            color: #aaa;
            cursor: help;
            transition: 0.2s;
        }
        #buff-display:hover { background: #333; }

        /* Main Event Area */
        #event-display {
            min-height: 200px;
            background: #222;
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border: 1px solid #444;
            position: relative;
            overflow: hidden;
        }

        .monster-icon { font-size: 4em; margin-bottom: 10px; display: inline-block; transition: 0.3s; }
        
        /* Glow Effects */
        .glow-blue { filter: drop-shadow(0 0 10px #2196f3); }
        .glow-red { filter: drop-shadow(0 0 15px #f44336); transform: scale(1.1); }
        .glow-purple { filter: drop-shadow(0 0 20px #9c27b0); animation: true-form-pulse 2s infinite; transform: scale(1.3); }

        @keyframes true-form-pulse {
            0% { filter: drop-shadow(0 0 20px #9c27b0); }
            50% { filter: drop-shadow(0 0 40px #e040fb); }
            100% { filter: drop-shadow(0 0 20px #9c27b0); }
        }

        /* Animations */
        @keyframes spawn-pop { 0% { transform: scale(0); opacity: 0; } 70% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes damage-shake { 0% { transform: translate(0, 0); filter: none; } 20% { transform: translate(-10px, 0) rotate(-5deg); filter: brightness(2) sepia(1) hue-rotate(-50deg) saturate(5); } 40% { transform: translate(10px, 0) rotate(5deg); } 60% { transform: translate(-5px, 0); } 80% { transform: translate(5px, 0); } 100% { transform: translate(0, 0); filter: none; } }
        @keyframes attack-lunge { 0% { transform: translateY(0) scale(1); } 30% { transform: translateY(20px) scale(1.2); } 100% { transform: translateY(0) scale(1); } }
        @keyframes screen-shake { 0% { transform: translate(0, 0); } 25% { transform: translate(-5px, 5px); } 50% { transform: translate(5px, -5px); } 75% { transform: translate(-5px, -5px); } 100% { transform: translate(0, 0); } }
        @keyframes float-up { 0% { transform: translateY(0) scale(1); opacity: 1; } 50% { transform: translateY(-30px) scale(1.2); opacity: 1; } 100% { transform: translateY(-60px) scale(1); opacity: 0; } }

        .anim-spawn { animation: spawn-pop 0.5s ease-out forwards; }
        .anim-damage { animation: damage-shake 0.4s ease-in-out; }
        .anim-lunge { animation: attack-lunge 0.3s ease-in-out; }
        .anim-screen-shake { animation: screen-shake 0.3s ease-in-out; }

        .floating-text {
            position: absolute; left: 50%; top: 40%; transform: translateX(-50%);
            font-weight: bold; font-size: 1.5em; pointer-events: none;
            text-shadow: 2px 2px 0 #000; z-index: 100;
            animation: float-up 1s ease-out forwards;
        }

        /* Text Styles */
        .damage-text { color: #ff5252; font-weight: bold; }
        .crit-text { color: #ff0000; font-size: 1.2em; font-weight: bold; text-shadow: 0 0 5px #fff; }
        .heal-text { color: #69f0ae; }
        .gold-text { color: #ffd700; }
        .block-text { color: #2196f3; font-weight: bold; }
        .pierce-text { color: #ff9800; font-weight: bold; }
        .angel-text { color: var(--buff-angel); font-weight: bold; }
        .demon-text { color: var(--buff-demon); font-weight: bold; }
        .mythic-text { color: var(--mythic); font-weight: bold; text-shadow: 0 0 5px #fff; }

        /* Controls */
        #controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 12px; border: none; border-radius: var(--border-radius); cursor: pointer; font-size: 1em; font-weight: bold; transition: 0.2s; background: #444; color: white; }
        button:hover { background: #555; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: var(--accent-color); color: #000; }
        .btn-primary:hover { background: #ffb74d; }
        
        /* Inventory */
        #inventory-section { background: #222; padding: 10px; border-radius: var(--border-radius); }
        .equipment-slots { display: flex; gap: 5px; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #444; }
        .equip-slot { flex: 1; background: #333; padding: 8px; border-radius: 4px; text-align: center; font-size: 0.75em; min-height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 1px solid #444; }
        
        .inv-container { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .inv-col h4 { margin: 0 0 5px 0; font-size: 0.85em; color: #888; text-align: center; border-bottom: 1px solid #444; padding-bottom: 3px; }
        .item-list { display: flex; flex-direction: column; gap: 4px; max-height: 200px; overflow-y: auto; min-height: 50px; background: #2a2a2a; padding: 5px; border-radius: 4px; }
        
        .item { padding: 4px 8px; background: #333; border-radius: 3px; font-size: 0.8em; cursor: pointer; border: 1px solid transparent; display: flex; align-items: center; gap: 5px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }
        .item:hover { background: #444; }

        /* Rarity */
        .rarity-common { color: var(--common); border-color: #555; }
        .rarity-uncommon { color: var(--uncommon); border-color: var(--uncommon); }
        .rarity-rare { color: var(--rare); border-color: var(--rare); }
        .rarity-epic { color: var(--epic); border-color: var(--epic); box-shadow: 0 0 5px var(--epic); }
        .rarity-legendary { color: var(--legendary); border-color: var(--legendary); box-shadow: 0 0 8px var(--legendary); background: linear-gradient(45deg, #333, #443300); animation: shine 2s infinite linear; }
        .rarity-mythic { color: var(--mythic); border-color: var(--mythic); box-shadow: 0 0 15px var(--mythic); background: #220011; animation: shine 1s infinite linear; }
        .rarity-ultra { color: var(--ultra); border-color: var(--ultra); box-shadow: 0 0 20px var(--ultra); background: #001122; animation: shine 0.5s infinite linear; }
        
        @keyframes shine { 0% { border-color: var(--legendary); } 50% { border-color: #fff; } 100% { border-color: var(--legendary); } }

        /* MERCHANT GRID FIX: 2x2 */
        .merchant-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 8px; 
            width: 100%; 
        }
        
        .merchant-item { display: flex; flex-direction: column; background: #333; padding: 10px; border-radius: 4px; cursor: pointer; border: 1px solid #444; }
        .merchant-item:hover { background: #444; }
        .m-top { display: flex; justify-content: space-between; font-weight: bold; }
        .m-desc { font-size: 0.8em; color: #aaa; margin-top: 4px; }

        /* Modals */
        #class-modal, #achieve-modal, #compendium-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        #class-modal { display: flex; }

        .class-options { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 500px; width: 100%; padding: 20px; max-height: 90vh; overflow-y: auto; }
        .class-card {
            background: #333; padding: 20px; border-radius: 8px; cursor: pointer;
            border: 2px solid #555; text-align: center; transition: 0.2s;
        }
        .class-card:hover { border-color: var(--accent-color); background: #444; transform: translateY(-5px); }
        .class-title { font-size: 1.2em; font-weight: bold; color: var(--accent-color); margin-bottom: 10px; }
        .class-desc { font-size: 0.9em; color: #ccc; }

        /* Achievements & Compendium */
        .achieve-list, .compendium-container { max-height: 70vh; overflow-y: auto; width: 90%; max-width: 600px; background: #222; padding: 20px; border-radius: 8px; border: 1px solid #444; }
        .achieve-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #333; opacity: 0.5; }
        .achieve-item.unlocked { opacity: 1; background: #2a2a2a; }
        .achieve-info { display: flex; flex-direction: column; }
        .achieve-name { font-weight: bold; font-size: 1.1em; }
        .achieve-cond { font-size: 0.8em; color: #aaa; }
        .achieve-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }

        .compendium-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; padding-top: 10px; }
        .c-item { 
            background: #333; border: 1px solid #444; border-radius: 4px; padding: 10px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; cursor: help; min-height: 80px; position: relative;
        }
        .c-item.unlocked { background: #2d2d2d; }
        .c-item.unknown { background: #222; border-color: #333; opacity: 0.7; filter: grayscale(100%); }
        .c-item.secret-hidden { background: #000; border-color: #000; cursor: default; }
        
        .c-icon { font-size: 2em; margin-bottom: 5px; }
        .c-name { font-size: 0.75em; line-height: 1.2; word-break: break-all; }
        .c-item.unknown .c-name { color: #666; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="class-modal">
    <h2 style="color:white; margin-bottom: 30px;">é¸æ“‡ä½ çš„è·æ¥­</h2>
    <div class="class-options">
        <div class="class-card" onclick="Game.selectClass('knight')">
            <div class="class-title">ğŸ›¡ï¸ é¨å£«</div>
            <div class="class-desc">é–‹å±€è£å‚™ã€Œé¨å£«é•·æ§ã€<br>çˆ†æ“Šå¼·åŒ–ç‚ºã€Œæ¸¾èº«ä¸€æ“Šã€ (3å€å‚·å®³)</div>
        </div>
        <div class="class-card" onclick="Game.selectClass('merchant')">
            <div class="class-title">ğŸ’° å•†è²©</div>
            <div class="class-desc">å‡ºå”®åƒ¹æ ¼ 1.2 å€<br>å•†åº—å¯è³¼è²· 6 é …å•†å“</div>
        </div>
        <div class="class-card" onclick="Game.selectClass('thief')">
            <div class="class-title">ğŸ—¡ï¸ ç›œè³Š</div>
            <div class="class-desc">é–‹å•Ÿå¯¶ç®±æ™‚<br>ä¸æœƒé‡åˆ°é™·é˜±æˆ–ç©ºç®±</div>
        </div>
        <div class="class-card" onclick="Game.selectClass('cultist')">
            <div class="class-title">ğŸ˜ˆ æƒ¡é­”ä¿¡å¾’</div>
            <div class="class-desc">é–‹å±€è‡ªå¸¶<br>ä¸€å€‹æƒ¡é­”è©›å’’</div>
        </div>
        <div class="class-card" onclick="Game.selectClass('scarecrow')">
            <div class="class-title">ğŸŒ¾ ç¨»è‰äºº</div>
            <div class="class-desc">å¿…å®šè¶•èµ°å“ˆæ¯”<br>ç„¡æ³•è£å‚™é‡å‹ç›¾ç‰Œ</div>
        </div>
        <div class="class-card" onclick="Game.selectClass('ape')">
            <div class="class-title">ğŸ¦ äººçŒ¿</div>
            <div class="class-desc">é­é‡è·Œå€’äº‹ä»¶<br>å¿…å®šæŠ“ä½å²©å£</div>
        </div>
<div class="class-card" onclick="Game.selectClass('challenger')">
    <div class="class-title">ğŸ§— æŒ‘æˆ°è€…</div>
    <div class="class-desc">ç„¡ä»»ä½•ç‰¹æ®ŠæŠ€èƒ½<br>é–‹å±€ç²å¾—ä¸€ç“¶ã€Œå¼·åŠ›è—¥æ°´ã€</div>
</div>
    </div>
</div>

<div id="achieve-modal">
    <div style="width:90%; max-width:600px; display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h2 style="color:white; margin:0;">ğŸ† æˆå°±åˆ—è¡¨</h2>
        <button onclick="document.getElementById('achieve-modal').style.display='none'" style="background:#555;">é—œé–‰</button>
    </div>
    <div id="achieve-stats" style="color:#aaa; margin-bottom:10px;"></div>
    <div class="achieve-list" id="achieve-list-content"></div>
</div>

<div id="compendium-modal">
    <div style="width:90%; max-width:600px; display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
        <h2 style="color:white; margin:0;">ğŸ“– ç‰©å“åœ–é‘‘</h2>
        <button onclick="document.getElementById('compendium-modal').style.display='none'" style="background:#555;">é—œé–‰</button>
    </div>
    <div id="compendium-stats" style="color:#aaa; margin-bottom:10px;"></div>
    <div class="compendium-container">
        <div class="compendium-grid" id="compendium-content"></div>
    </div>
</div>

<div id="credits-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:200; flex-direction:column; align-items:center; justify-content:center;">
    <div style="width:90%; max-width:400px; background:#222; padding:30px; border-radius:8px; border:1px solid #444; text-align:center; box-shadow: 0 0 20px rgba(0,0,0,0.8);">
        <h2 style="color:white; margin:0 0 15px 0;">ğŸ‘¨â€ğŸ’» ä½œè€…åå–®</h2>
        <p style="color:#ccc; margin-bottom:25px; line-height: 1.5;">
            æ„Ÿè¬éŠç©ã€Šå¹»æƒ³å†’éšªã€‹ï¼<br>æ­¡è¿é—œæ³¨æˆ‘çš„ç¤¾ç¾¤ä»¥ç²å¾—æœ€æ–°è³‡è¨Šã€‚
        </p>
        <div style="display:flex; flex-direction:column; gap:15px;">
            <a href="https://www.threads.net/@kanda_shota_art?igshid=NTc4MTIwNjQ2YQ==" target="_blank" style="text-decoration:none;">
                <button style="width:100%; padding:15px; background:#111; color:#fff; border:1px solid #333; font-size:1em; display:flex; align-items:center; justify-content:center; gap:10px;">
                    <span>â—‰</span> Threads (@kanda_shota_art)
                </button>
            </a>
            <a href="https://x.com/shota_at_?s=21" target="_blank" style="text-decoration:none;">
                <button style="width:100%; padding:15px; background:#000; color:#fff; border:1px solid #333; font-size:1em; display:flex; align-items:center; justify-content:center; gap:10px;">
                    <span>ğ•</span> Twitter (X)
                </button>
            </a>
            <a href="https://www.buymeacoffee.com/maker.shota" target="_blank" style="text-decoration:none;">
                <button style="width:100%; padding:15px; background:#FFDD00; color:#000; border:none; font-size:1em; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:10px;">
                    <span>âš”ï¸</span> è´ŠåŠ©æˆ‘å‰é€²
                </button>
            </a>
        </div>
        <button onclick="document.getElementById('credits-modal').style.display='none'" style="margin-top:25px; background:#555; width: 100%;">é—œé–‰</button>
    </div>
</div>

<div id="game-container">
    <header>
        <div style="display:flex; align-items:center; gap:10px;">
            <div style="font-weight: bold; font-size: 1.2em;">âš”ï¸ å¹»æƒ³å†’éšª</div>
            <button onclick="Game.showAchievements()" style="padding:4px 8px; font-size:0.8em;">ğŸ† æˆå°±</button>
            <button onclick="Game.showCompendium()" style="padding:4px 8px; font-size:0.8em; background:#673ab7;">ğŸ“– åœ–é‘‘</button>
<button onclick="Game.showCredits()" style="padding:4px 8px; font-size:0.8em; background:#ff5722;">ğŸ‘¨â€ğŸ’» ä½œè€…</button>
        </div>
        <div id="class-badge" class="class-badge"></div>
    </header>

    <div class="stats-grid">
        <div class="stat-item">ç”Ÿå‘½: <span id="hp-val">100</span> / <span id="max-hp-val">100</span></div>
        <div class="stat-item">æ”»æ“Š: <span id="atk-val">5</span></div>
        <div class="stat-item">é‡‘å¹£: <span id="gold-val">100</span></div>
        <div class="stat-item">æ·±åº¦: <span id="depth-val">0</span> å±¤</div>
        <div id="buff-display" title="é»æ“ŠæŸ¥çœ‹è©³ç´°æ•ˆæœ">ç‹€æ…‹: ç„¡</div>
    </div>

    <div id="event-display">
        <div id="event-icon" class="monster-icon">ğŸ²</div>
        <h3 id="event-title">æº–å‚™å†’éšª</h3>
        <div id="event-desc">è«‹å…ˆé¸æ“‡è·æ¥­...</div>
        <div id="merchant-area" class="hidden"></div>
    </div>

    <div id="controls">
        <button id="btn-main" class="btn-primary" onclick="Game.nextEvent()">é–‹å§‹å†’éšª</button>
        <button id="btn-sub" onclick="Game.handleSubAction()" disabled>...</button>
    </div>

    <div id="inventory-section">
        <div class="equipment-slots">
            <div class="equip-slot" id="slot-weapon" onclick="Game.unequip('weapon')">ç„¡æ­¦å™¨</div>
            <div class="equip-slot" id="slot-armor" onclick="Game.unequip('armor')">ç„¡é˜²å…·</div>
            <div class="equip-slot" id="slot-shield" onclick="Game.unequip('shield')">ç„¡ç›¾ç‰Œ</div>
        </div>
        
        <div class="inv-container">
            <div class="inv-col">
                <h4>ğŸ“¦ è£å‚™</h4>
                <div class="item-list" id="inv-equip"></div>
            </div>
            <div class="inv-col">
                <h4>ğŸ§ª æ¶ˆè€—å“</h4>
                <div class="item-list" id="inv-consum"></div>
            </div>
            <div class="inv-col">
                <h4>ğŸ§© ç´ æ</h4>
                <div class="item-list" id="inv-mat"></div>
            </div>
        </div>
    </div>

    <div style="margin-top: 20px; border-top: 1px solid #444; padding-top: 15px;">
        <button onclick="Game.manualRestart()" style="width: 100%; background: #d32f2f; opacity: 0.8;">ğŸ”„ é‡æ–°é–‹å§‹éŠæˆ²</button>
    </div>
</div>

<script>
// ===== ç©å®¶åˆå§‹è¨­å®š =====
let player = {
  hp: 100,
  maxHp: 100,
  atk: 10,
  gold: 50,
  floor: 1,
  artifacts: [],
  class: null
};

// ===== ç¥å™¨æ± ï¼ˆä¸é‡è¤‡ï¼‰=====
const artifactPool = [
  "ğŸŒ ç¥ä¹‹å…‰è¼",
  "âš¡ é›·éœ†ä¹‹å¿ƒ",
  "ğŸ”¥ ä¸æ»…ç«ç¨®",
  "ğŸ’ æ°¸æ†æ°´æ™¶",
  "ğŸŒ™ æš—å½±ä¹‹å¥‘"
];

// ===== è·æ¥­è³‡æ–™ =====
const classes = {
  knight: { name: "é¨å£«", hp: 120, atk: 12 },
  merchant: { name: "å•†è²©", gold: 200, atk: 8 },
  thief: { name: "ç›œè³Š", hp: 100, atk: 10 },
  cultist: { name: "æƒ¡é­”ä¿¡å¾’", hp: 90, atk: 11 },
  druid: { name: "ç¨»è‰äºº", hp: 110, atk: 9 },
  ape: { name: "äººçŒ¿", hp: 130, atk: 7 },
  challenger: { name: "æŒ‘æˆ°è€…", hp: 100, atk: 10 }
};

// ===== æ¨“å±¤äº‹ä»¶æ©Ÿåˆ¶ â€”â€” æˆ°é¬¥ â†’ å•†åº— â†’ å¯¶ç®± â†’ æˆ°é¬¥ â†’ å›è¡€ =====
function getEvent(floor) {
  if (floor % 20 === 0) return "boss";
  const seq = ["battle", "shop", "treasure", "battle", "heal"];
  return seq[(floor - 1) % 5];
}

// ===== UI æ›´æ–° =====
function updateUI(message = "") {
  document.getElementById("event-display").innerHTML = message;
  document.getElementById("stats-display").innerHTML = `
    â¤ï¸ HP: ${player.hp}/${player.maxHp}<br>
    âš”ï¸ æ”»æ“ŠåŠ›: ${player.atk}<br>
    ğŸ’° é‡‘å¹£: ${player.gold}<br>
    ğŸ” æ·±åº¦: ${player.floor} å±¤
  `;
  document.getElementById("inventory-display").innerHTML =
    player.artifacts.length
      ? player.artifacts.join("ã€")
      : "ï¼ˆå°šæœªç²å¾—ç¥å™¨ï¼‰";
}

// ===== å¯¶ç®±ï¼ˆç¥å™¨å„ªå…ˆã€ä¸é‡è¦†ï¼‰=====
function openTreasure() {
  let available = artifactPool.filter(a => !player.artifacts.includes(a));
  if (available.length > 0) {
    let pick = available[Math.floor(Math.random() * available.length)];
    player.artifacts.push(pick);
    return `ğŸ“¦ ä½ æ‰“é–‹äº†é‡‘è‰²å¯¶ç®±ï¼ç²å¾—ç¥å™¨ï¼š<span class="text-amber-400">${pick}</span>`;
  } else {
    let gold = Math.floor(Math.random() * 200) + 200;
    player.gold += gold;
    return `âœ¨ æ‰€æœ‰ç¥å™¨å·²æ”¶é›†ï¼ç²å¾— <span class="text-yellow-300">${gold} é‡‘å¹£</span>`;
  }
}

// ===== æˆ°é¬¥äº‹ä»¶ï¼ˆæ°¸é æš´æ“Š+é€ƒè·‘æ°¸é æˆåŠŸï¼‰=====
function battleEvent() {
  player.gold += 50;
  updateUI(`âš”ï¸ é­é‡æ€ªç‰©ä¸¦æˆ°å‹ï¼<br>ğŸ”¥ æ°¸é æš´æ“Š (${player.atk * 2} å‚·å®³)<br>ğŸ’° ç²å¾— 50 é‡‘å¹£`);
  renderChoices(["ç¹¼çºŒå‰é€²"]);
}

// ===== å•†åº—äº‹ä»¶ =====
function shopEvent() {
  updateUI(`ğŸ›’ é‡åˆ°å•†äºº<br>èŠ±è²» 50 é‡‘å¹£ â¤ æ°¸ä¹… +5 æ”»æ“ŠåŠ›`);
  renderChoices(["è³¼è²·æå‡", "è·³é"]);
}

// ===== å›è¡€äº‹ä»¶ï¼ˆHPâ‰¥80% â†’ æ”¹ç‚ºæˆ°é¬¥ï¼‰=====
function healEvent() {
  if (player.hp >= player.maxHp * 0.8) {
    battleEvent();
    return;
  }
  let gain = Math.floor(player.maxHp * 0.3);
  player.hp = Math.min(player.maxHp, player.hp + gain);
  updateUI(`ğŸ›Œ ä½ ä¼‘æ¯ä¸¦æ¢å¾©äº† <span class="text-green-400">${gain} HP</span>`);
  renderChoices(["ç¹¼çºŒå‰é€²"]);
}

// ===== Boss æˆ°ï¼ˆé€ƒè·‘100%æˆåŠŸã€ç¥å™¨å¿…å‡ºã€å›è¡€ã€é‡‘å¹£ï¼‰=====
function bossEvent() {
  let reward = openTreasure();
  player.hp = player.maxHp;
  player.gold += 200;
  updateUI(`
    ğŸ‘‘ Big Boss å‡ºç¾ï¼<br>
    ğŸƒâ€â™‚ï¸ ä½ é¸æ“‡é€ƒè·‘ â€”â€” æ°¸é æˆåŠŸ<br><br>
    ${reward}<br><br>
    â¤ï¸ å›æ»¿ç”Ÿå‘½å€¼<br>
    ğŸ’° é¡å¤–ç²å¾— 200 é‡‘å¹£
  `);
  renderChoices(["é€²å…¥ä¸‹ä¸€è¼ª"]);
}

// ===== é¸é …æ§åˆ¶ =====
function renderChoices(options) {
  const c = document.getElementById("controls");
  c.innerHTML = "";
  options.forEach(text => {
    let btn = document.createElement("button");
    btn.innerHTML = text;
    btn.className = "px-6 py-2 rounded bg-amber-600 hover:bg-amber-500";
    btn.onclick = () => handleChoice(text);
    c.appendChild(btn);
  });
}

function handleChoice(choice) {
  if (choice === "è³¼è²·æå‡" && player.gold >= 50) {
    player.gold -= 50;
    player.atk += 5;
  }
  player.floor++;
  nextEvent();
}

// ===== æ ¸å¿ƒäº‹ä»¶å¼•æ“ =====
function nextEvent() {
  const evt = getEvent(player.floor);
  if (evt === "battle") battleEvent();
  if (evt === "shop") shopEvent();
  if (evt === "treasure") { updateUI(openTreasure()); renderChoices(["ç¹¼çºŒå‰é€²"]); }
  if (evt === "heal") healEvent();
  if (evt === "boss") bossEvent();
}

// ===== è·æ¥­é¸æ“‡ï¼ˆä¿®å¾©ç„¡åæ‡‰å•é¡Œï¼‰=====
function selectClass(classKey) {
  const job = classes[classKey];
  player.class = job.name;
  player.hp = job.hp || player.hp;
  player.maxHp = job.hp || player.maxHp;
  if (job.gold) player.gold += job.gold;
  player.atk = job.atk || player.atk;
  document.getElementById("class-modal").style.display = "none";
  nextEvent();
}

window.onload = function () {
  document.querySelectorAll(".class-option").forEach(btn => {
    const job = btn.getAttribute("data-class");
    if (job) btn.onclick = () => selectClass(job);
  });
  updateUI("è«‹é¸æ“‡ä½ çš„è·æ¥­é–‹å§‹å†’éšªï¼");
};
</script>


</body>
</html>


